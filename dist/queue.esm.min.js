var n=class{events={};on(t,e){typeof this.events[t]!="object"&&(this.events[t]=[]),this.events[t].push(e);let s=this;return function(){s.removeListener(t,e)}}removeListener(t,e){var s;typeof this.events[t]=="object"&&(s=this.events[t].indexOf(e),s>-1&&this.events[t].splice(s,1))}emit(t){if(typeof this.events[t]=="object"){var e,s,i,r=[].slice.call(arguments,1);for(s=this.events[t].slice(),i=s.length,e=0;e<i;e++)try{s[e].apply(this,r)}catch(o){console.error(t,r),console.error(o)}}}once(t,e){return this.on(t,function s(){this.removeListener(t,s),e.apply(this,arguments)})}waitForEvent(t,e=0){return new Promise(s=>{let i,r=this.on(t,()=>{e>0&&clearTimeout(i),r(),s(!0)});e>0&&(i=setTimeout(()=>{r(),s(!1)},e))})}waitForAnyEvent(t,e=0){return new Promise(s=>{let i,r=[],o=()=>{e>0&&clearTimeout(i),r.forEach(h=>{h()}),s(!0)};t.forEach(h=>{r.push(this.on(h,o))}),e>0&&(i=setTimeout(()=>{o(),s(!1)},e))})}};var u=class{#i=0;#s=new Set;#t=0;#e=new n;on(t,e){return this.#e.on(t,e)}add(...t){this.#i++;let e=this.#i;return this.#s.add(e),this.#t++,this.#e.emit("add",e,t),e}remove(t){this.#s.has(t)&&(this.#s.delete(t),this.#t--,this.#e.emit("remove",t),this.#e.emit("change"),this.#t===0&&this.#e.emit("empty"))}async addTaskAndRun(t){let e=this.add(t),s=null;try{s=await t()}catch(i){console.error(i)}finally{this.remove(e)}return s}get size(){return this.#t}waitForLessThan(t){return this.#t<t?Promise.resolve():new Promise(e=>{let s=this.#e.on("change",()=>{this.#t<=t&&(s(),e())})})}waitUntilEmpty(){return this.#t===0?Promise.resolve():this.#e.waitForEvent("empty")}};export{u as Queue};
